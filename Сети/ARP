ARP
Address Resolution Protocol
Работает динамически
ARP объединяет IP-адрес клиента (Layer3) с MAC-адресом (Layer2)ARP
Можно также настроить вручную

ARP
Media Access Control - надзор
за доступом к среде, также Hardware Address. MAC-48 наиболее распространены
каждый производитель получает диапазон в координирующем
комитете IEEE Registration Authority уникальный идентификатор, присваиваемый оборудованию производителем и некоторым сетевым интерфейсам
МАС должны быть уникальны в одном L2 канале

Как работает?
Мне нужно отправить информацию на адрес 192.168.1.7, но у меня есть только IP-адрес. Я не знаю МАС-адрес устройства, которому присвоен этот IP адрес.

Если адрес сети (network address) адреса назначения (dst address)
равна адресу сети (network address) источника (src address), посылай широковещательный запрос

ARP В ЛОКАЛЬНОЙ СЕТИ
Если адрес сети (network address) адреса назначения (dst address) равна адресу сети (network address) источника (src address), посылай широковещательный запрос для получения тас-адреса назначения (dst mac-address)
192.0.2.254/24 = 192.0.2.1/24 => широковещательный запрос "кто есть 192.0.2.1"

ARP запрос
50:00:01:02:00:01 (SRC MAC) > ff:ff:ff:ff:ff:ff (DST MAC), ethertype ARP (0x0806): Ethernet (len 6), IPv4 (len 4), Request who-has 192.0.2.254 tell 192.0.2.1

ARP ответ
50:00:00:01:00:00 (SC MAC) > 50:00:01:02:00:01 (DST MAC), ethertype ARP (0x0806):
Ethernet (len 6), IPV4 (len 4), Reply 192.0.2.254 is-at 50:00:00:01:00:00

ARP С УДАЛЕННОЙ СЕТЬЮ
Если адрес сети (network address) адреса назначения (dst address) не равен на адресу сети (network address) адреса источника (src address), то мы отправляем пакеты нашему шлюзу - то есть подставляем в заголовки кадров МАС-адрес нашего шлюза
192.0.2.254/24 != 192.0.0.254/24 => отправляем пакеты шлюзу 192.0.2.1

Если не знаем МАС-адрес шлюза
192.0.2.254/24 = 192.0.2.1/24 => широковещательный ARP запрос "кто есть 192.0.2.1"

С удаленной сетью фактически нет ARP запросов и ответов.
Кадры отправляются на МАС-адреса нашего шлюза. Если мы не знаем МАС-адрес шлюза - то тогда посылается ARP-запрос на IP-адрес шлюза.

global uniclie, local administered, multicast
8 бит первого байта МАС адреса называется Unicast/Multicast битом и определяет, какого типа кадр (фрейм) передается с этим адресом, обычный (0) или широковещательный (1) (мультикаст или броадкаст).
7 бит первого байта МАС адреса называется U/L (Universal/Local) битом и определяет, является ли адрес глобально уникальным (0), или локально уникальным (1).
С шестого по первый биты первого байта, биты второго и третьего байта в OUI идентификаторах,
и тем более биты в 4-6 байтах адреса, назначаемые производителем, распределены более-менее равномерно.
Таким образом, в реальном МАС-адресе сетевого адаптера биты фактически равноценны и не несут технологического смысла, за исключением двух служебных бит старшего байта.

global uniclie
• Если Ой бит МАС-адреса равен 0, а 1й бит равен 1 - то перед нами global uniclie mac-address
• Уникальность МАС-адресов достигается тем, что каждый производитель получает в координирующем комитете IEEE Registration Authority диапазон из 16 777 216 (224) адресов и, по мере исчерпания выделенных адресов, может запросить новый диапазон
• Поэтому по трём старшим байтам МАС-адреса можно определить производителя
• Существуют таблицы, позволяющие определить производителя по МАС-адресу
• Глобально администрируемый МАС-адрес устройства глобально уникален и обычно «зашит» в аппаратуру

local administered mac-address
• Если Ой бит МАС-адреса равен 0, а 1й бит равен 0 - то перед нами local administered mac-address
• По факту тас-адрес не привязанный к производителю и назначенный администратором
• При ручном назначении тас-адреса важно использовать именно local administered mac-address

multicast
• Если Ой бит МАС-адреса равен 1, то перед нами multicast mac-address
• 01-00-5E-00-00-00 до 01-00-5E-7F-FF-FF IPv4 Multicast
• 33-33-00-00-00-00 до 33-33-FF-FF-FF-FF IPv6 multicast
• 01-80-C2-XX-XX-XX Служебные протоколы STP, LLDP, EAPOL
