OSI - OPEN SYSTEMS INTERCONNECT
Концептуальная модель, описывающая универсальный стандарт взаимодействия компьютерных и телекоммуникационных систем, на зависящая от их внутреннего устройства и специфических протоколов

OSI
ФИЗИЧЕСКИЙ УРОВЕНЬ
Область действия - ближайшее активное устройство
Функции:
• Кодирование
• Мультиплексирование
• Синхронизация
Электрические провода, радиосвязь, волоконно-оптические провода, инфракрасное излучение

OSI
КАНАЛЬНЫЙ УРОВЕНЬ
Область действия - ближайший маршрутизатор (Network Node)
Функции:
• Передача данных
• Взаимодействие с физическим уровнем
• Обнаружение и исправление ошибок
• Определение начала и конца блока данных
Ethernet, Token ring, PPP, MPLS

OSI
СЕТЕВОЙ УРОВЕНЬ
Область действия - конечные устройства взаимодействия
Функции:
• Маршрутизация трафика
• Определение конечных точек через адресацию
• Сквозной контроль ошибок
1P, ICMP, IGMP, OSPF, RIP, ARP

OSI
ТРАНСПОРТНЫЙ УРОВЕНЬ
Область действия - приложения на конечных устройствах
Функции:
• Разделение между приложениями
• Контроль доставки
Транспортный уровень (layer 4):
• Сегментация данных
• Контроль сессий
• Идентификация приложений
ТСР
Устанавливает сессию и отслеживает ее состояние. ТСР - handshake:
Проверяет доставку пакета и повторно высылает потерянные данные
Хранение сессий отъедает ресурсы памяти
Медленный относительно UDP
Работает только для соединений точка-точка (unicast)
Используется, например, для НТТР,
HTTPS, FTP, SFTP

UDP
Не устанавливает сессию:
Не обеспечивает надежной доставки
Не хранит сессий
Быстрее TCP
Работает для broadcast и multicast
соединений
Используется для стриминговых приложений: передачи голоса, видео
TCP, UDP, SPX, GRE

Основные выводы
• ТСР - надежно и медленно: Выполняются handshake, повторная отправка данных при потере
• UDP - ненадежно, но быстро

OSI
СЕССИОННЫЙ (ИЛИ СЕАНСОВЫЙ) УРОВЕНЬ
Область действия - приложения на конечных устройствах
Функции:
• Создание/завершение сеанса
• Обмен информацией
• Синхронизация задач
• Определение права на передачу данных
• Поддержание сеанса в периоды неактивности приложений
NetBIOS, PPTP, L2TP, ASP

OSI
УРОВЕНЬ ПРЕДСТАВЛЕНИЯ
Область действия - приложения на конечных устройствах
Функции:
• Сжатие/распаковка
• Преобразование данных
• Шифрование/ дешифрование
• Перенаправление запросов другому сетевому ресурсу
XDR, TLS, SSL

OSI
ПРИКЛАДНОЙ УРОВЕНЬ
Область действия - приложения на конечных устройствах
Функции:
• Позволяет приложениям использовать сетевые службы
• Передача служебной информации
• Предоставляет приложениям информацию об ошибках
• Формирует запросы к уровню представления
HTTP, SMTP, FTP, Telnet, SSH, SMB, NFS, RTSP, BGP

ГЛАВНОЕ ПРО OSI ISO
Уровни не зависят друг от друга 
7 уровней
Только конечные системы обрабатывают данные на каждом уровне 
Модель-концепция. Эталонная. Референсная. В жизни не используется
Промежуточные сетевые узлы обрабатывают данные вплоть до сетевого уровня


ТСР/Р. ПРИКЛАДНОЙ УРОВЕНЬ
Примеры:
• HTTP(S) 
• DHCP
• SSH
• SMTP
• DNS
• NTP
Контрольные протоколы:
• BGP
• SNMP
• OSPF

ТСР/Р. ТРАНСПОРТНЫЙ УРОВЕНЬ
Область действия - сокеты на конечных устройствах
Примеры:
• ТСР
• UDP
• SCTP
• QUIK

ТСР/Р. СЕТЕВОЙ УРОВЕНЬ
Область действия - конечные устройства взаимодействия
Примеры:
• IPv4
• IPv6

ТСР/Р. КАНАЛЬНЫЙ/ФИЗИЧЕСКИЙ УРОВЕНЬ
Область действия - ближайший маршрутизатор (Network Node)
Примеры:
• Ethernet
• Wi-Fi
• Bluetooth

PDU
Transport Layer PDU - Segment/Datagram
Network Layer PDU - Packet
Link Layer - Frame

ГЛАВНОЕ ПРО ТСР/IP
Реально работающий стек
Соткан из костылей
Только конечные хосТЫ ДОЛЖНЫ обрабатывать данные на всех уровнях
Промежуточные сетевые узлы должны обрабатывать данные на уровне не выше сетевого
Фактически сетевые узлы забираются вплоть до прикладного
Нарушается принцип сквозной сВЯзноСТИ

TCPDUMP
• Позволяет собирать и анализировать трафик, проходящий через узел
• Не только ТСР - любой
• Требует sudo

СЕТЕВАЯ МАСКА
• Используется хостом
• Не передается в пакете
• Нужна для определения границ сети
• Служит для разделения сетей на подсети

UNICAST, MULTICAST, BROADCAST, ANYCAST
Unicast
Пример:
192.168.1.1/28
Multicast
Пример:
224.0.0.0 - 239.255.255.255
Broadcast
192.168.1.127/28
Anycast

ОСНОВНЫЕ ВЫВОДЫ
Где используется
Публичные «Белые» В Интернет
Частные «Серые» В локальных сетях

Охват хостов в сети
Unicast
Одному конкретному узлу

Multicast
Группе узлов

Broadcast
Всем узлам сети

Anycast
Какому-то узлу

Диапазоны портов
Общий диапазон: от 0 до 65535.
1-1023 - системные (well-known), распределены IANA
1024-49151 - пользовательские, назначается пользователем для пользовательских сервисов
49152-65535 - динамические, используются операционной системой
Система Linux применяет в качестве динамических портов диапазон 32768-60999

Маршрутизация
ЧТО ЭТО ТАКОЕ/КАК РАБОТАЕТ
• Любому сетевому приложению необходимо отправлять пакеты по сети
• Чтобы передать пакеты от источника (SRC) к получателю (DST) необходимо знать, как дойти до получателя и каким путем
• Маршрутизация - процесс определения лучшего пути в іР сетях, по которому пакет может быть доставлен получателю
• Маршруты - это возможные пути передачи пакетов
• Все маршруты хранятся в таблицах маршрутизации
• Активные маршруты попадают в таблицу пересылки

[HTTP заголовок][Данные приложения (браузера)] Данные - L7-L5
[ТСР заголовок][Данные приложения с НТТР заголовком] Сегмент L4
[IP заголовок][Данные приложения с НТТР и ТСР заголовками] Пакет L3
[Ethernet заголовок][Данные приложения с НТТР, ТСР и IP заголовками] Кадр L2

ROUTING
Работает на 3-м уровне OSl network layer (L3)
Правила маршрутизации определяют, куда отправлять пакеты
В одной таблице маршрутизации не может быть двух одинаковых маршрутов в активном состоЯниИ
Для выбора активного маршрута используется параметр metric - чем больше число тем больше вероятность выбора маршрута в качестве активного (ip -s route get 192.168.78.2)
При нескольких активных маршрутах, указывающих на один адрес выбирается более точный (с большей маской)