ЧТО ТАКОЕ DHCP
DHCP (Dynamic Host Configuration Protocol) - прикладной протокол, позволяющий сетевым устройствам автоматически получать IP-адреса и другие параметры, необходимые для работы в сети ТСР/IP
• Работает по модели клиент-сервер
• Используется только в доверенных сетях
• Работает в одном широковещательном домене
• REC1531

DORA
• Discovery 
src-mac=<client>, dst-mac=<broadcast>, protocol-udp, src-ip=0.0.0.0:68, dst-ip=255.255.255.255:67
• Offer
src-mac=<DHCP-server>, dst-mac=<broadcast>, protocol=udp, src-ip=<DHCP-server>:67, dst ip=255.255.255.255:67
• Request 
src-mac=<client>, dst-mac=<broadcast>, protocol=up, src-ip=0.0.0.0:68, dst-ip=255.255.255.255:67
• Acknowledgement 
src-mac=<DHCP-server>, dst-mac=<broadcast>, protocol-udp, src-ip=<DHCP-server>:67, dst-ip=255.255.255.255:67

ОСОБЫЕ DHCP СООБШЕНИЯ
DHCPNAK - отправляется сервером вместо окончательного подтверждения. Такой отказ может быть отправлен клиенту, если аренда запрашиваемого IP истекла или клиент перешел в новую подсеть
DHCPRELEASE - клиент отправляет это сообщение, чтобы уведомить сервер об освобождении занимаемого IP. Это досрочное окончание аренды
DHCPINFORM - этим сообщением клиент запрашивает у сервера локальные настройки.
Отправляется, когда клиент уже получил IP, но для правильной работы ему требуется конфигурация сети. Сервер информирует клиента ответным сообщением с указанием всех запрошенных опций

DHCP CLIENT IDENTIFICATION
DHCP-сервер может отслеживать ассоциацию аренды с конкретным клиентом на основе идентификации
Идентификация может быть достигнута двумя способами:
• Основана на "caller-id" option (dhcp-client-identifier from RFC2132)
• На основе МАС-адреса, если параметр «caller-id» не указан

DHCP LEASE TIME
• Аренда DHCP может быть назначена практически любой продолжительности от нуля секунд до бесконечности.
• Какая продолжительность аренды имеет смысл для любой данной подсети или для любой конкретной установки, зависит от типов обслуживаемых хостов:
• Для общественного места с общим WiFi имеет смысл приравнят время аренды к среднему времени нахождения клиента
• Для корпоративных клиентов имеет смысл увеличивать время аренды - для возможного обслуживания DHCP сервера без влияния на клиентов
• Настраивается параметрами:
• default-lease-time 600;
• max-lease-time 7200;

DHCP options
Для работы в сети клиенту требуется не только IP, но и другие параметры DHCP - например, маска подсети, шлюз по умолчанию и адрес сервера
Опции представляют собой пронумерованные пункты, строки данных, которые содержат необходимые клиенту сервера параметры конфигурации

DHCP options
Дадим описания некоторым опциям:
• Option 1 - маска подсети IP
• Option 3 - основной шлюз
• Option 6 - адрес сервера DNS (основной и резервный)
• Option 51 - определяет, на какой срок IP-адрес предоставляется в аренду клиенту
• Option 55 - список запрашиваемых опций. Клиент всегда запрашивает опции для правильной конфигурации. Отправляя сообщение с Option 55, клиент выставляет список запрашиваемых числовых кодов опций в порядке предпочтения. DHCP-сервер старается отправить ответ с опциями в том же порядке

DHCP STATIC LEASES
Можно всегда назначать один и тот же |Р-адрес для одного и того же устройства (определенного по MAC-address)
Сервер DHCP может даже использоваться без динамического пула IP и назначать только предварительно настроенные адреса